local M={ns=vim.api.nvim_create_namespace'small_large'}
M.letter={
    [' ']={
        [[   ]],
        [[   ]],
        [[   ]],
        [[   ]],
        [[   ]],
    },
    ['!']={
        [[ ]],
        [[|]],
        [[|]],
        [[.]],
        [[ ]],
    },
    ['"']={
        [[   ]],
        [[| |]],
        [[   ]],
        [[   ]],
        [[   ]],
    },
    ['#']={
        [[ | | ]],
        [[-+-+-]],
        [[-+-+-]],
        [[ | | ]],
        [[     ]],
    },
    ['$']={
        [[/| ]],
        [[\| ]],
        [[ |\]],
        [[ |/]],
        [[   ]],
    },
    ['%']={
        [[   ]],
        [[o /]],
        [[ / ]],
        [[/ o]],
        [[   ]],
    },
    ['&']={
        [[__ ]],
        [[\/ ]],
        [[|\/]],
        [[\/\]],
        [[   ]],
    },
    ["'"]={
        [[ ]],
        [[|]],
        [[ ]],
        [[ ]],
        [[ ]],
    },
    ['(']={
        [[  /]],
        [[ / ]],
        [[ \ ]],
        [[  \]],
        [[   ]],
    },
    [')']={
        [[ \ ]],
        [[  \]],
        [[  /]],
        [[ / ]],
        [[   ]],
    },
    ['*']={
        [[   ]],
        [[\|/]],
        [[-+-]],
        [[/|\]],
        [[   ]],
    },
    ['+']={
        [[   ]],
        [[ | ]],
        [[-+-]],
        [[ | ]],
        [[   ]],
    },
    [',']={
        [[   ]],
        [[   ]],
        [[   ]],
        [[/\ ]],
        [[|/ ]],
    },
    ['-']={
        [[   ]],
        [[   ]],
        [[___]],
        [[   ]],
        [[   ]],
    },
    ['.']={
        [[   ]],
        [[   ]],
        [[   ]],
        [[/\ ]],
        [[\/ ]],
    },
    ['/']={
        [[   ]],
        [[  /]],
        [[ / ]],
        [[/  ]],
        [[   ]],
    },
    ['0']={
        [[ _ ]],
        [[| |]],
        [[|/|]],
        [[|_|]],
        [[   ]],
    },
    ['1']={
        [[   ]],
        [[/| ]],
        [[ | ]],
        [[_|_]],
        [[   ]],
    },
    ['2']={
        [[__ ]],
        [[  )]],
        [[ / ]],
        [[/__]],
        [[   ]],
    },
    ['3']={
        [[__ ]],
        [[  )]],
        [[-- ]],
        [[__)]],
        [[   ]],
    },
    ['4']={
        [[ / ]],
        [[/| ]],
        [[-+-]],
        [[ | ]],
        [[   ]],
    },
    ['5']={
        [[ __]],
        [[|_ ]],
        [[  \]],
        [[ _/]],
        [[   ]],
    },
    ['6']={
        [[ __]],
        [[/  ]],
        [[|- ]],
        [[|_|]],
        [[   ]],
    },
    ['7']={
        [[___]],
        [[  /]],
        [[ / ]],
        [[/  ]],
        [[   ]],
    },
    ['8']={
        [[ _ ]],
        [[| |]],
        [[|-|]],
        [[|_|]],
        [[   ]],
    },
    ['9']={
        [[ _ ]],
        [[| |]],
        [[ -|]],
        [[ _/]],
        [[   ]],
    },
    [':']={
        [[   ]],
        [[ . ]],
        [[ . ]],
        [[   ]],
        [[   ]],
    },
    [';']={
        [[   ]],
        [[ . ]],
        [[ , ]],
        [[   ]],
        [[   ]],
    },
    ['<']={
        [[  /]],
        [[ / ]],
        [[ \ ]],
        [[  \]],
        [[   ]],
    },
    ['=']={
        [[   ]],
        [[___]],
        [[___]],
        [[   ]],
        [[   ]],
    },
    ['>']={
        [[\  ]],
        [[ \ ]],
        [[ / ]],
        [[/  ]],
        [[   ]],
    },
    ['?']={
        [[ _ ]],
        [[/ \]],
        [[  /]],
        [[ | ]],
        [[ . ]],
    },
    ['@']={
        [[ ___ ]],
        [[/ _ \]],
        [[ / ||]],
        [[ \_||]],
        [[     ]],
    },
    A={
        [[   ]],
        [[ _ ]],
        [[|_|]],
        [[| |]],
        [[   ]],
    },
    B={
        [[   ]],
        [[ _ ]],
        [[|_)]],
        [[|_)]],
        [[   ]],
    },
    C={
        [[ __]],
        [[|  ]],
        [[|  ]],
        [[|__]],
        [[   ]],
    },
    D={
        [[ _ ]],
        [[| \]],
        [[| |]],
        [[|_/]],
        [[   ]],
    },
    E={
        [[ __]],
        [[|  ]],
        [[|- ]],
        [[|__]],
        [[   ]],
    },
    F={
        [[ __]],
        [[|  ]],
        [[|- ]],
        [[|  ]],
        [[   ]],
    },
    G={
        [[   ]],
        [[ _ ]],
        [[/_ ]],
        [[\_|]],
        [[   ]],
    },
    H={
        [[| |]],
        [[|_|]],
        [[| |]],
        [[| |]],
        [[   ]],
    },
    I={
        [[___]],
        [[ | ]],
        [[ | ]],
        [[_|_]],
        [[   ]],
    },
    J={
        [[ __]],
        [[  |]],
        [[  |]],
        [[  |]],
        [[\_/]],
    },
    K={
        [[| /]],
        [[|/ ]],
        [[|\ ]],
        [[| \]],
        [[   ]],
    },
    L={
        [[|  ]],
        [[|  ]],
        [[|  ]],
        [[|__]],
        [[   ]],
    },
    M={
        [[     ]],
        [[\   /]],
        [[|\ /|]],
        [[| v |]],
        [[     ]],
    },
    N={
        [[   ]],
        [[\ |]],
        [[|\|]],
        [[| \]],
        [[   ]],
    },
    O={
        [[   ]],
        [[ _ ]],
        [[/ \]],
        [[\_/]],
        [[   ]],
    },
    P={
        [[__ ]],
        [[|_)]],
        [[|  ]],
        [[|  ]],
        [[   ]],
    },
    Q={
        [[   ]],
        [[ _ ]],
        [[/ \]],
        [[\_\]],
        [[   ]],
    },
    R={
        [[ _ ]],
        [[|_)]],
        [[|\ ]],
        [[| \]],
        [[   ]],
    },
    S={
        [[ __]],
        [[(  ]],
        [[ \ ]],
        [[__)]],
        [[   ]],
    },
    T={
        [[___]],
        [[ | ]],
        [[ | ]],
        [[ | ]],
        [[   ]],
    },
    U={
        [[|   |]],
        [[|   |]],
        [[|   |]],
        [[|___|]],
        [[     ]],
    },
    V={
        [[     ]],
        [[\   /]],
        [[ \ / ]],
        [[  v  ]],
        [[     ]],
    },
    W={
        [[     ]],
        [[| | |]],
        [[| | |]],
        [[|_|_|]],
        [[     ]],
    },
    X={
        [[\ /]],
        [[ v ]],
        [[ | ]],
        [[/ \]],
        [[   ]],
    },
    Y={
        [[\ /]],
        [[ v ]],
        [[ | ]],
        [[ | ]],
        [[   ]],
    },
    Z={
        [[__ ]],
        [[  /]],
        [[ / ]],
        [[/__]],
        [[   ]],
    },
    ['[']={
        [[ __]],
        [[|  ]],
        [[|  ]],
        [[|__]],
        [[   ]],
    },
    ['\\']={
        [[   ]],
        [[\  ]],
        [[ \ ]],
        [[  \]],
        [[   ]],
    },
    [']']={
        [[__ ]],
        [[  |]],
        [[  |]],
        [[__|]],
        [[   ]],
    },
    ['^']={
        [[ , ]],
        [[/ \]],
        [[   ]],
        [[   ]],
        [[   ]],
    },
    ['_']={
        [[   ]],
        [[   ]],
        [[   ]],
        [[___]],
        [[   ]],
    },
    ['`']={
        [[ ]],
        [[\]],
        [[ ]],
        [[ ]],
        [[ ]],
    },
    a={
        [[   ]],
        [[ __]],
        [[/ |]],
        [[\_|]],
        [[   ]],
    },
    b={
        [[|  ]],
        [[|_ ]],
        [[| \]],
        [[|_/]],
        [[   ]],
    },
    c={
        [[   ]],
        [[ __]],
        [[/  ]],
        [[\__]],
        [[   ]],
    },
    d={
        [[  |]],
        [[ _|]],
        [[/ |]],
        [[\_|]],
        [[   ]],
    },
    e={
        [[   ]],
        [[ _ ]],
        [[/-)]],
        [[\_ ]],
        [[   ]],
    },
    f={
        [[  _]],
        [[ / ]],
        [[_|_]],
        [[ | ]],
        [[ | ]],
    },
    g={
        [[   ]],
        [[ __]],
        [[|_|]],
        [[|_ ]],
        [[\/ ]],
    },
    h={
        [[|  ]],
        [[|_ ]],
        [[| |]],
        [[| |]],
        [[   ]],
    },
    i={
        [[ . ]],
        [[__ ]],
        [[ | ]],
        [[_|_]],
        [[   ]],
    },
    j={
        [[  .]],
        [[  |]],
        [[  |]],
        [[  |]],
        [[\_/]],
    },
    k={
        [[   ]],
        [[|| ]],
        [[||/]],
        [[||\]],
        [[   ]],
    },
    l={
        [[   ]],
        [[ | ]],
        [[ | ]],
        [[ \_]],
        [[   ]],
    },
    m={
        [[     ]],
        [[,___ ]],
        [[| | |]],
        [[| | |]],
        [[     ]],
    },
    n={
        [[   ]],
        [[,_ ]],
        [[| |]],
        [[| |]],
        [[   ]],
    },
    o={
        [[   ]],
        [[   ]],
        [[ _ ]],
        [[(_)]],
        [[   ]],
    },
    p={
        [[   ]],
        [[__ ]],
        [[| \]],
        [[|_/]],
        [[|  ]],
    },
    q={
        [[   ]],
        [[ __]],
        [[/ |]],
        [[\_|]],
        [[  |]],
    },
    r={
        [[   ]],
        [[  _]],
        [[|/ ]],
        [[|  ]],
        [[   ]],
    },
    s={
        [[   ]],
        [[ _ ]],
        [[|_ ]],
        [[ _|]],
        [[   ]],
    },
    t={
        [[   ]],
        [[_|_]],
        [[ | ]],
        [[ \_]],
        [[   ]],
    },
    u={
        [[   ]],
        [[_ _]],
        [[| |]],
        [[\_|]],
        [[   ]],
    },
    v={
        [[   ]],
        [[_ _]],
        [[| |]],
        [[ v ]],
        [[   ]],
    },
    w={
        [[     ]],
        [[     ]],
        [[| | |]],
        [[\_|_/]],
        [[     ]],
    },
    x={
        [[   ]],
        [[\ /]],
        [[ X ]],
        [[/ \]],
        [[   ]],
    },
    y={
        [[   ]],
        [[   ]],
        [[\ /]],
        [[ v ]],
        [[/  ]],
    },
    z={
        [[   ]],
        [[___]],
        [[ _/]],
        [[/__]],
        [[   ]],
    },
    ['{']={
        [[  /]],
        [[ | ]],
        [[-  ]],
        [[ | ]],
        [[  \]],
    },
    ['|']={
        [[|]],
        [[|]],
        [[|]],
        [[|]],
        [[|]],
    },
    ['}']={
        [[\  ]],
        [[ | ]],
        [[  -]],
        [[ | ]],
        [[/  ]],
    },
    ['~']={
        [[   ]],
        [[   ]],
        [[/\/]],
        [[   ]],
        [[   ]],
    },
    [true]={
        [[ ]],
        [[ ]],
        [[%]],
        [[ ]],
        [[ ]],
    }
}
for _,v in pairs(M.letter) do
    local format='%s'
    if #v[1]==1 then
        format='  %s  '
    elseif #v[1]==3 then
        format=' %s '
    end
    for idx,str in ipairs(v) do
        v[idx]=format:format(str)
    end
end
function M.start()
    vim.cmd.hi('SmallLargeCursor blend=100 guifg=white guibg=white')
    vim.o.guicursor='a:SmallLargeCursor,a:ver1'
    vim.api.nvim_set_decoration_provider(M.ns,{
        on_buf=function (_,bufnr)
            vim.api.nvim_buf_clear_namespace(bufnr,M.ns,0,-1)
        end,
        on_win=function (_,winid,bufnr,botline,topline)
            vim.api.nvim_buf_clear_namespace(bufnr,M.ns,botline,topline+1)
            local buf=vim.defaulttable(function() return {{},{},{},{},{}} end)
            local cursorpos=vim.api.nvim_win_get_cursor(winid)
            for row=botline,topline do
                for col=0,#vim.api.nvim_buf_get_lines(bufnr,row,row+1,false)[1] do
                    local char=vim.api.nvim_buf_get_text(bufnr,row,col,row,col+1,{})[1]
                    local text=M.letter[char]
                    if not text then
                        text=vim.deepcopy(M.letter[true],true)
                        for k,v in ipairs(text) do
                            text[k]=v:gsub('%%',char)
                        end
                    end
                    local hl
                    if col==cursorpos[2] and row==cursorpos[1]-1 then
                        hl='Cursor'
                    end
                    for k,v in ipairs(text) do
                        table.insert(buf[row][k],{v,hl})
                    end
                end
            end
            for row,line in pairs(buf) do
                local lines={}
                for _,v in ipairs(line) do
                    table.insert(lines,v)
                end
                vim.api.nvim_buf_set_extmark(bufnr,M.ns,row,0,{
                    virt_text=table.remove(lines,1),
                    virt_text_pos='overlay',
                    virt_lines=lines,
                })
            end
        end})
end
return M
